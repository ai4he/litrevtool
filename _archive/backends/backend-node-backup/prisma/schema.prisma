// Prisma schema for LitRevTool - migrated from Python SQLAlchemy models

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(uuid())
  email      String   @unique
  googleId   String   @unique @map("google_id")
  name       String?
  picture    String?
  isActive   Boolean  @default(true) @map("is_active")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  // Relationships
  searchJobs SearchJob[]

  @@index([email])
  @@index([googleId])
  @@map("users")
}

model SearchJob {
  id       String @id @default(uuid())
  userId   String @map("user_id")

  // Search parameters
  name             String
  keywordsInclude  String  @map("keywords_include") // JSON string
  keywordsExclude  String  @default("[]") @map("keywords_exclude") // JSON string
  semanticCriteria String? @map("semantic_criteria") // JSON string
  startYear        Int?    @map("start_year")
  endYear          Int?    @map("end_year")

  // Job status
  status           String  @default("pending") // pending, running, paused, completed, failed
  progress         Float   @default(0.0) // 0.0 to 100.0
  totalPapersFound Int     @default(0) @map("total_papers_found")
  papersProcessed  Int     @default(0) @map("papers_processed")

  // Error handling and resumption
  lastCheckpoint  String? @map("last_checkpoint") // JSON string
  errorMessage    String? @map("error_message")
  retryCount      Int     @default(0) @map("retry_count")

  // Bull task
  bullTaskId      String? @map("bull_task_id")

  // Results
  csvFilePath     String? @map("csv_file_path")

  // Timestamps
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  startedAt   DateTime? @map("started_at")
  completedAt DateTime? @map("completed_at")

  // Relationships
  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  papers Paper[]

  @@index([userId])
  @@map("search_jobs")
}

model Paper {
  id           String @id @default(uuid())
  searchJobId  String @map("search_job_id")

  // Paper metadata
  title       String
  authors     String?
  year        Int?
  abstract    String?
  source      String? // Journal/Conference name
  citations   Int     @default(0)
  url         String?
  doi         String?

  // Additional metadata
  keywords    String? // JSON string
  publisher   String?

  // Semantic filtering
  semanticScore Int? @map("semantic_score") // If semantic filtering was applied

  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")

  // Relationships
  searchJob SearchJob @relation(fields: [searchJobId], references: [id], onDelete: Cascade)

  @@index([searchJobId])
  @@map("papers")
}
