# Single Source Update Guide

## Overview

LitRevTool uses **one React codebase** for multiple platforms:

```
frontend/src/ (Single Source)
      â†“
      â”œâ”€â”€ ğŸŒ Web App (browsers)
      â”œâ”€â”€ ğŸ’» Desktop App (Electron wrapper)
      â””â”€â”€ ğŸ“± Mobile App (Capacitor wrapper)
          â”œâ”€â”€ iOS
          â””â”€â”€ Android
```

## Quick Update: All Platforms at Once

To update all platforms from the single React source:

```bash
npm run build:all
```

This command:
1. âœ… Builds the React app (`frontend/build/`)
2. âœ… Syncs to mobile platforms (iOS + Android)
3. âœ… Builds the desktop app (Electron)

**Result**: All platforms updated from one command!

## Individual Platform Updates

### Update Web Only

```bash
cd frontend
npm run build
```

Deploy to production:
```bash
npm run deploy:prod
```

### Update Mobile Only

```bash
npm run mobile:sync
```

Then open in native IDE to test/build:
```bash
npm run mobile:open:ios      # Xcode
npm run mobile:open:android  # Android Studio
```

### Update Desktop Only

```bash
npm run electron:build
```

Platform-specific builds:
```bash
npm run electron:build:mac
npm run electron:build:win
npm run electron:build:linux
```

## Development Workflow

### Making Code Changes

1. **Edit React code** in `frontend/src/`
   - All components, pages, styles
   - Changes apply to ALL platforms automatically

2. **Test in browser** (fastest iteration)
   ```bash
   cd frontend
   npm start
   ```
   Visit `http://localhost:3001`

3. **Test in desktop** (when ready)
   ```bash
   npm run electron:dev
   ```

4. **Test on mobile** (when ready)
   ```bash
   npm run mobile:sync
   npm run mobile:open:ios     # or android
   ```

### Platform-Specific Code

If you need platform-specific behavior, use these utilities:

```javascript
import { isMobileApp, getPlatform } from './mobile';

// Check if running in mobile app
if (isMobileApp()) {
  console.log('Running in mobile app');
}

// Get specific platform
const platform = getPlatform(); // 'web', 'ios', or 'android'

// Conditional rendering
{isMobileApp() && <MobileOnlyFeature />}
{!isMobileApp() && <WebOnlyFeature />}
```

For Electron:
```javascript
const isElectron = window.navigator.userAgent.includes('Electron');

if (isElectron) {
  console.log('Running in Electron');
}
```

## File Organization

```
litrevtool/
â”œâ”€â”€ frontend/                 # SINGLE SOURCE FOR ALL PLATFORMS
â”‚   â”œâ”€â”€ src/                 # React app (web + mobile + desktop)
â”‚   â”œâ”€â”€ build/               # Built web app (output)
â”‚   â”œâ”€â”€ ios/                 # iOS app (generated by Capacitor)
â”‚   â”œâ”€â”€ android/             # Android app (generated by Capacitor)
â”‚   â”œâ”€â”€ capacitor.config.ts  # Mobile config
â”‚   â””â”€â”€ package.json         # Frontend + mobile scripts
â”œâ”€â”€ electron/                # Desktop wrapper
â”‚   â”œâ”€â”€ main.js             # Electron main process
â”‚   â””â”€â”€ package.json        # Desktop scripts
â”œâ”€â”€ mobile/                  # Mobile documentation
â”‚   â”œâ”€â”€ README.md           # Mobile setup guide
â”‚   â”œâ”€â”€ setup.sh            # Automated setup script
â”‚   â””â”€â”€ resources/          # Icons, splash screens
â””â”€â”€ package.json            # Root scripts (build:all, etc.)
```

## Common Scenarios

### Scenario 1: Add New Feature

1. Code the feature in `frontend/src/`
2. Test in browser: `cd frontend && npm start`
3. Update all platforms: `npm run build:all` (from root)
4. Test each platform:
   - Web: Deploy to server
   - Desktop: `npm run electron:dev`
   - Mobile: `npm run mobile:open:ios/android`

### Scenario 2: Fix UI Bug

1. Fix bug in `frontend/src/`
2. Test immediately in browser
3. When satisfied: `npm run build:all`
4. All platforms now have the fix!

### Scenario 3: Update Dependencies

```bash
cd frontend
npm install <package>
npm run build:all  # Rebuild everything
```

### Scenario 4: Production Deployment

**Web:**
```bash
npm run deploy:prod
```

**Desktop:**
```bash
npm run electron:build:mac   # or :win, :linux
# Upload installers from electron/dist/
```

**Mobile:**
```bash
npm run mobile:sync
npm run mobile:open:ios      # Build in Xcode â†’ Archive â†’ Upload
npm run mobile:open:android  # Build in Android Studio â†’ Generate AAB
```

## Build Outputs

| Platform | Output Location | Distribution |
|----------|----------------|--------------|
| Web | `frontend/build/` | Deploy to web server |
| Desktop (macOS) | `electron/dist/*.dmg` | Download link / Mac App Store |
| Desktop (Windows) | `electron/dist/*.exe` | Download link / Microsoft Store |
| Desktop (Linux) | `electron/dist/*.AppImage` | Download link / Snap Store |
| iOS | `frontend/ios/` | Xcode â†’ App Store Connect |
| Android | `frontend/android/` | Android Studio â†’ Google Play |

## Tips for Single Source Development

### âœ… DO

- Develop features in React components (applies to all)
- Use responsive design (works on web + mobile)
- Test in browser first (fastest feedback)
- Use `build:all` to update everything at once
- Keep platform-specific code minimal

### âŒ DON'T

- Duplicate code between platforms
- Hard-code platform assumptions
- Edit generated files in `ios/` or `android/` directly
  (they get regenerated on sync)
- Forget to test on all target platforms before release

## Troubleshooting

### Changes not appearing in mobile?

```bash
npm run mobile:sync  # Forces rebuild and sync
```

### Changes not appearing in desktop?

```bash
cd electron
npm run build  # Rebuild Electron
```

### Build failed?

```bash
cd frontend
rm -rf build node_modules
npm install
npm run build
```

### Mobile app won't open?

Make sure backend is running and accessible:
- For production: Use `https://litrev.haielab.org`
- For development: Use your local IP (not `localhost`)
- Check `capacitor.config.ts` for server URL

## Version Control

The `.gitignore` is configured to:
- âœ… Track: React source code, configs
- âŒ Ignore: Build outputs, generated mobile projects

```
# Tracked
frontend/src/
frontend/capacitor.config.ts
electron/main.js

# Ignored (regenerated)
frontend/build/
frontend/ios/
frontend/android/
electron/dist/
```

## Continuous Integration

To automate builds on CI/CD:

```yaml
# Example GitHub Action
- name: Build all platforms
  run: |
    npm install
    npm run mobile:install
    npm run build:all
```

## Summary

**Key Principle**: One React codebase â†’ Many platforms

1. Write code once in `frontend/src/`
2. Run `npm run build:all`
3. All platforms updated! ğŸ‰

For detailed platform-specific instructions:
- Web: [frontend/README.md](frontend/README.md)
- Desktop: [electron/README.md](electron/README.md)
- Mobile: [mobile/README.md](mobile/README.md)
