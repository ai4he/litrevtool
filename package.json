{
  "name": "litrevtool",
  "version": "1.0.0",
  "description": "LitRevTool - Google Scholar Literature Review Tool",
  "scripts": {
    "deploy": "bash deploy-node.sh",
    "deploy:prod": "cd frontend && npm run build:prod && sudo mkdir -p /var/www/litrev && sudo cp -r build/* /var/www/litrev/ && sudo chown -R www-data:www-data /var/www/litrev && echo 'Frontend deployed to /var/www/litrev'",
    "install:all": "echo 'ðŸ“¦ Installing backend dependencies...' && cd backend && python3 -m venv venv && source venv/bin/activate && pip install --upgrade pip && pip install -r requirements.txt && deactivate && cd .. && echo 'ðŸ“¦ Installing frontend dependencies...' && cd frontend && npm install && cd .. && echo 'âœ… All dependencies installed!'",
    "setup:db": "cd backend && source venv/bin/activate && python3 -c \"from app.db.session import engine; from app.models import Base; Base.metadata.create_all(bind=engine); print('Database initialized')\" && deactivate && cd ..",
    "start": "pm2 start ecosystem.config.js",
    "stop": "pm2 stop ecosystem.config.js",
    "restart": "pm2 restart ecosystem.config.js",
    "reload": "pm2 reload ecosystem.config.js",
    "delete": "pm2 delete ecosystem.config.js",
    "status": "pm2 status",
    "logs": "pm2 logs",
    "logs:frontend": "pm2 logs litrev-frontend",
    "logs:backend": "pm2 logs litrev-backend",
    "logs:celery": "pm2 logs litrev-celery",
    "monit": "pm2 monit",
    "monitor": "pm2 status && echo '\n--- CPU & Memory Usage ---' && top -bn1 | grep 'Cpu\\|Mem' && echo '\n--- Port Usage ---' && sudo lsof -i -P -n | grep LISTEN | grep -E ':(3001|8000|6379)' && echo '\n--- Recent Backend Logs ---' && tail -n 10 backend/logs/backend-out.log 2>/dev/null || echo 'No backend logs yet' && echo '\n--- Recent Frontend Logs ---' && tail -n 10 frontend/logs/frontend-out.log 2>/dev/null || echo 'No frontend logs yet'",
    "save": "pm2 save",
    "kill:port": "lsof -ti:3001 | xargs kill -9 2>/dev/null || true",
    "clean:restart": "npm run kill:port && npm run restart",
    "reset": "echo 'ðŸ”„ Starting full system reset...' && echo '\n1ï¸âƒ£  Stopping all PM2 processes...' && pm2 stop all 2>/dev/null || true && sleep 1 && echo '\n2ï¸âƒ£  Killing any stuck processes on ports 3001, 8000...' && (lsof -ti:3001 | xargs kill -9 2>/dev/null || true) && (lsof -ti:8000 | xargs kill -9 2>/dev/null || true) && echo '\n3ï¸âƒ£  Clearing Celery task queue and results in Redis...' && redis-cli FLUSHDB && echo '\n4ï¸âƒ£  Cleaning up any orphaned Playwright/Chromium processes...' && pkill -f 'chromium|playwright' 2>/dev/null || true && echo '\n5ï¸âƒ£  Clearing old screenshots (keeping DB data)...' && find backend/uploads/screenshots -name '*.png' -type f -delete 2>/dev/null || true && echo '\n6ï¸âƒ£  Clearing PM2 logs...' && pm2 flush && echo '\n7ï¸âƒ£  Resetting any stuck search jobs to failed state...' && cd backend && source venv/bin/activate && python3 -c \"from app.db.session import SessionLocal; from app.models import SearchJob; db = SessionLocal(); stuck = db.query(SearchJob).filter(SearchJob.status.in_(['running', 'pending'])).all(); [setattr(job, 'status', 'failed') or setattr(job, 'status_message', 'Reset by system cleanup') for job in stuck]; db.commit(); print(f'Reset {len(stuck)} stuck jobs'); db.close()\" 2>/dev/null || echo 'No stuck jobs to reset' && deactivate && cd .. && echo '\n8ï¸âƒ£  Starting all services fresh...' && pm2 start ecosystem.config.js && sleep 2 && echo '\n9ï¸âƒ£  Verifying services...' && pm2 status && echo '\nâœ… Reset complete! System ready for new executions.\n' && echo 'ðŸ“Š Quick health check:' && sleep 2 && curl -s http://localhost:8000/docs > /dev/null && echo '  âœ“ Backend API responding' || echo '  âœ— Backend not ready' && curl -s http://localhost:3001 > /dev/null && echo '  âœ“ Frontend responding' || echo '  âœ— Frontend not ready' && redis-cli ping > /dev/null && echo '  âœ“ Redis responding' || echo '  âœ— Redis not ready'",
    "debug": "bash -c \"echo 'ðŸ” LitRevTool Debug Information' && echo '================================' && echo '' && echo 'ðŸ“Š Service Status:' && pm2 status && echo '' && echo 'ðŸ—„ï¸  Database Status:' && cd backend && source venv/bin/activate && python3 -c \\\"from app.db.session import SessionLocal; from app.models import SearchJob, User, Paper; from sqlalchemy import func; db = SessionLocal(); print(f'  Total Users: {db.query(func.count(User.id)).scalar()}'); print(f'  Total Jobs: {db.query(func.count(SearchJob.id)).scalar()}'); pending = db.query(func.count(SearchJob.id)).filter(SearchJob.status == 'pending').scalar(); running = db.query(func.count(SearchJob.id)).filter(SearchJob.status == 'running').scalar(); completed = db.query(func.count(SearchJob.id)).filter(SearchJob.status == 'completed').scalar(); failed = db.query(func.count(SearchJob.id)).filter(SearchJob.status == 'failed').scalar(); print(f'  Jobs - Pending: {pending}, Running: {running}, Completed: {completed}, Failed: {failed}'); print(f'  Total Papers: {db.query(func.count(Paper.id)).scalar()}'); db.close()\\\" && deactivate && cd .. && echo '' && echo 'ðŸ“¡ Redis Status:' && redis-cli ping > /dev/null && echo '  Status: Connected' || echo '  Status: Disconnected' && echo '  Celery Queue Length: '$(redis-cli llen celery) && echo '' && echo 'ðŸ”¥ Recent Celery Errors:' && tail -20 backend/logs/celery-error.log 2>/dev/null | grep -E 'ERROR|Error|Exception|Traceback' || echo '  No recent errors' && echo '' && echo 'ðŸ“¸ Recent Screenshots:' && ls -lht backend/uploads/screenshots/ 2>/dev/null | head -6 || echo '  No screenshots' && echo '' && echo 'ðŸŒ Endpoint Health:' && curl -s http://localhost:8000/health | python3 -m json.tool 2>/dev/null || echo '  Backend not responding'\"",
    "debug:jobs": "bash -c \"echo 'ðŸ” Checking stuck/running jobs...' && echo '' && cd backend && source venv/bin/activate && python3 -c \\\"from app.db.session import SessionLocal; from app.models import SearchJob; from datetime import datetime; db = SessionLocal(); jobs = db.query(SearchJob).filter(SearchJob.status.in_(['running', 'pending'])).all(); print(f'Found {len(jobs)} jobs in running/pending state:'); print(''); [print(f'  â€¢ Job: {job.name}\\\\n    ID: {job.id}\\\\n    Status: {job.status}\\\\n    Created: {job.created_at}\\\\n    Message: {job.status_message}\\\\n    Papers: {job.total_papers_found}\\\\n') for job in jobs]; db.close()\\\" && deactivate\"",
    "debug:reset-jobs": "bash -c \"echo 'ðŸ”„ Resetting stuck jobs...' && echo '' && cd backend && source venv/bin/activate && python3 -c \\\"from app.db.session import SessionLocal; from app.models import SearchJob; db = SessionLocal(); stuck = db.query(SearchJob).filter(SearchJob.status.in_(['running', 'pending'])).all(); print(f'Found {len(stuck)} stuck jobs:'); [print(f'  - {job.name} ({job.status})') for job in stuck]; [setattr(job, 'status', 'failed') or setattr(job, 'status_message', 'Reset by debug command') for job in stuck]; db.commit(); print(f''); print(f'âœ“ Reset {len(stuck)} jobs to failed state'); db.close()\\\" && deactivate\"",
    "debug:errors": "echo 'ðŸ”¥ Recent Celery Errors:\n' && tail -50 backend/logs/celery-error.log 2>/dev/null | grep -A 3 -E 'ERROR|Error|Exception' || echo 'No recent errors found'",
    "debug:health": "echo 'ðŸ¥ System Health Check\n' && echo '1. Services:' && pm2 status | grep -E 'litrev-backend|litrev-celery|litrev-frontend' && echo '\n2. Backend API:' && curl -s http://localhost:8000/health && echo '\n\n3. Redis:' && redis-cli ping && echo '\n4. Celery Queue:' && redis-cli llen celery && echo ' tasks in queue' && echo '\n5. Disk Space:' && df -h | grep -E 'Filesystem|/$' && echo '\n6. Memory:' && free -h | grep -E 'total|Mem'",
    "debug:last-job": "bash -c \"echo 'ðŸ“‹ Last Search Job Details:' && echo '' && cd backend && source venv/bin/activate && python3 -c \\\"from app.db.session import SessionLocal; from app.models import SearchJob; db = SessionLocal(); job = db.query(SearchJob).order_by(SearchJob.created_at.desc()).first(); [print(f'{k}: {v}') for k,v in {'Name': job.name, 'ID': job.id, 'Status': job.status, 'Created': job.created_at, 'Started': job.started_at, 'Completed': job.completed_at, 'Message': job.status_message, 'Papers': job.total_papers_found, 'Progress': str(job.progress)+'%', 'Keywords': job.keywords_include, 'Years': str(job.start_year)+'-'+str(job.end_year)}.items()] if job else print('No jobs found'); db.close()\\\" && deactivate\"",
    "debug:screenshots": "echo 'ðŸ“¸ Recent Screenshots:\n' && ls -lht backend/uploads/screenshots/ 2>/dev/null | head -10 || echo 'No screenshots found'",
    "cli": "bash -c 'cd backend && source venv/bin/activate && python3 cli_search.py \"$@\"' --",
    "cli:help": "bash -c 'cd backend && source venv/bin/activate && python3 cli_search.py --help'"
  },
  "keywords": [
    "literature-review",
    "google-scholar",
    "research"
  ],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "axios": "^1.13.2",
    "cheerio": "^1.1.2",
    "socks-proxy-agent": "^8.0.5"
  }
}
